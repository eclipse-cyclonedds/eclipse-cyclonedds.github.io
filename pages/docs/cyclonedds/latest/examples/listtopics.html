
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>listtopics &#8212; Eclipse Cyclone DDS, 0.11.0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/basic_mod.css?v=0.7.0-1" />
    <link rel="stylesheet" type="text/css" href="../_static/css/helpers.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/helpers.js"></script>
    <script src="../_static/js/theme.js"></script>
    <script src="../_static/js/petite-vue.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="dynsub" href="dynsub.html" />
    <link rel="prev" title="Throughput" href="throughput.html" /> 
  </head><body>

<div id="top_nav">
    

    <nav>
        <p id="toggle_sidebar">
            <a href="#" title="Toggle sidebar">|||</a>
        </p>
        <h1><a href="../index.html" title="Go to homepage">Eclipse Cyclone DDS, 0.11.0</a></h1>

        <a id="mode_toggle" href="#" @click.prevent="handleClick" :title="mode">
    <template v-if="mode == 'light'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_light"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M67.48,18.073c1.913,-1.912 1.913,-5.018 0,-6.931c-1.912,-1.912 -5.018,-1.912 -6.931,0l-6.798,6.799c-1.912,1.912 -1.912,5.018 0,6.931c1.913,1.912 5.018,1.912 6.931,-0l6.798,-6.799Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.728,61.108c1.912,-1.913 1.912,-5.018 -0,-6.931c-1.913,-1.913 -5.019,-1.913 -6.931,-0l-6.799,6.798c-1.912,1.913 -1.912,5.019 0,6.931c1.913,1.913 5.019,1.913 6.931,0l6.799,-6.798Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.682,54.177c-1.913,-1.913 -5.018,-1.913 -6.931,-0c-1.912,1.913 -1.912,5.018 0,6.931l6.798,6.798c1.913,1.913 5.019,1.913 6.931,0c1.913,-1.912 1.913,-5.018 0,-6.931l-6.798,-6.798Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M4.901,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,-0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M18.929,11.142c-1.912,-1.912 -5.018,-1.912 -6.931,0c-1.912,1.913 -1.912,5.019 0,6.931l6.799,6.799c1.912,1.912 5.018,1.912 6.931,-0c1.912,-1.913 1.912,-5.019 -0,-6.931l-6.799,-6.799Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.108,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c-0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c-0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'dark'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_dark"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.901,2.196 -4.901,4.901c0,2.705 2.197,4.901 4.901,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.662,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.989,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.732,61.103c1.91,-1.91 1.91,-5.011 0,-6.921l-0.009,-0.01c-1.91,-1.91 -5.012,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.909,1.91 5.011,1.91 6.92,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.672,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.52,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l-0,-0.01c-0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.901,2.196 -4.901,4.901c0,2.704 2.197,4.9 4.901,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.73,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 -0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.098,34.623c-2.699,0 -4.891,2.192 -4.891,4.892l-0,0.019c-0,2.699 2.192,4.891 4.891,4.891c2.7,0 4.892,-2.192 4.892,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.892,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'darkest'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_darkest"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><path d="M39.315,23.791c8.684,-0 15.734,7.05 15.734,15.733c0,8.684 -7.05,15.734 -15.734,15.734c-8.683,0 -15.733,-7.05 -15.733,-15.734c-0,-8.683 7.05,-15.733 15.733,-15.733Zm0,4.737c6.069,0 10.997,4.927 10.997,10.996c-0,6.069 -4.928,10.996 -10.997,10.996c-6.068,0 -10.996,-4.927 -10.996,-10.996c0,-6.069 4.928,-10.996 10.996,-10.996Z" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.216,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.9,2.196 -4.9,4.901c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.666,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.99,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.737,61.103c1.909,-1.91 1.909,-5.011 -0,-6.921l-0.01,-0.01c-1.91,-1.91 -5.011,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.91,1.91 5.011,1.91 6.921,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.676,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.524,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l0,-0.01c0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.216,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901c-0,2.704 2.196,4.9 4.9,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.734,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.103,34.623c-2.7,0 -4.892,2.192 -4.892,4.892l-0,0.019c-0,2.699 2.192,4.891 4.892,4.891c2.699,0 4.891,-2.192 4.891,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.891,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>
</a>

<script>
(function() {
    const LOCAL_STORAGE_KEY = 'piccoloThemeMode'

    var initialMode = localStorage.getItem(LOCAL_STORAGE_KEY)

    if (initialMode) {
        // Make sure the value in local storage is valid
        if (['light', 'dark', 'darkest'].indexOf(initialMode) == -1) {
            initialMode = 'light'
            localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
        }
    } else {
        // Check if the client prefers dark mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            initialMode = 'dark'
        } else {
            initialMode = 'light'
        }
        localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
    }

    document.documentElement.dataset.mode = initialMode

    PetiteVue.createApp({
        'mode': initialMode,
        handleClick() {
            let currentMode = this.mode

            if (currentMode == 'light') {
                this.mode = 'dark'
            } else if (currentMode == 'dark') {
                this.mode = 'darkest'
            } else if (currentMode == 'darkest') {
                this.mode = 'light'
            }

            document.documentElement.dataset.mode = this.mode
            localStorage.setItem(LOCAL_STORAGE_KEY, this.mode)

            console.log(this.mode)
        }
    }).mount('#mode_toggle')
})()
</script>
            <p class="mobile_search_link">
                <a href="../search.html" title="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 65 64" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2">
                        <path d="M14.873 40.009c-2.315-3.943-3.642-8.532-3.642-13.429C11.231 11.91 23.141 0 37.811 0s26.58 11.91 26.58 26.58-11.91 26.58-26.58 26.58a26.44 26.44 0 0 1-14.277-4.161L9.739 62.794a3.12 3.12 0 0 1-4.413 0L.913 58.382c-1.217-1.218-1.217-3.196 0-4.413l13.96-13.96zM37.811 8.054c10.225 0 18.526 8.301 18.526 18.526s-8.301 18.526-18.526 18.526-18.526-8.301-18.526-18.526S27.586 8.054 37.811 8.054z" fill="#fff" />
                    </svg>
                </a>
            </p>
        

        <div class="searchbox_wrapper">
            
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
    </nav>
</div>

    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about_dds/eclipse_cyclone_dds.html">Eclipse Cyclone DDS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config/index.html">Configuration guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="helloworld.html">HelloWorld</a></li>
<li class="toctree-l2"><a class="reference internal" href="roundtrip.html">Roundtrip</a></li>
<li class="toctree-l2"><a class="reference internal" href="throughput.html">Throughput</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">listtopics</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynsub.html">dynsub</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security/dds_security.html">DDS security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shared_memory/shared_memory.html">Shared memory exchange</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ddsc.html">C API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary of terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="listtopics">
<span id="listtopics-bm"></span><span id="index-0"></span><h1>listtopics<a class="headerlink" href="#listtopics" title="Permalink to this heading">¶</a></h1>
<p>The listtopics example shows how to monitor topics that have been defined in the system.</p>
<section id="running-the-example">
<h2>Running the example<a class="headerlink" href="#running-the-example" title="Permalink to this heading">¶</a></h2>
<p>Discovering remote topics is only possible when topic discovery is enabled. To configure
topic discovery set:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Discovery&gt;</span>
<span class="w">  </span><span class="nt">&lt;EnableTopicDiscoveryEndpoints&gt;</span>true<span class="nt">&lt;/EnableTopicDiscoveryEndpoints&gt;</span>
<span class="nt">&lt;/Discovery&gt;</span>
</pre></div>
</div>
<p>Most applications create topics, which are always visible. The listtopics example creates
no topics and therefore, if there is no discovery of remote topics, shows no output. To
mitigate this, the listtopics example also monitors the discovery of other participants.
If any show up but no topics are discovered, it prints a warning.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Running two copies of the listtopics example (and nothing else) always triggers a warning.</p>
</div>
</section>
<section id="source-code">
<h2>Source code<a class="headerlink" href="#source-code" title="Permalink to this heading">¶</a></h2>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">listtopics.c</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="linenos">  2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
<span class="linenos">  3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="linenos">  4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;assert.h&gt;</span>
<span class="linenos">  5</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;dds/dds.h&quot;</span>
<span class="linenos">  6</span>
<span class="linenos">  7</span><span class="cm">/* Compile time constants representing the (DCPSPublication and DCPSSubscription) built-in</span>
<span class="linenos">  8</span><span class="cm">   topics that used for monitoring whether we should have discovered some topics on the</span>
<span class="linenos">  9</span><span class="cm">   DCPSTopic built-in topic. */</span>
<span class="linenos"> 10</span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">ep_topics</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 11</span><span class="w">  </span><span class="n">DDS_BUILTIN_TOPIC_DCPSPUBLICATION</span><span class="p">,</span>
<span class="linenos"> 12</span><span class="w">  </span><span class="n">DDS_BUILTIN_TOPIC_DCPSSUBSCRIPTION</span>
<span class="linenos"> 13</span><span class="p">};</span>
<span class="linenos"> 14</span>
<span class="linenos"> 15</span><span class="k">struct</span><span class="w"> </span><span class="nc">keystr</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 16</span><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="mi">36</span><span class="p">];</span><span class="w"> </span><span class="cm">/* (8 hex digits) : (8 h d) : (8 h d) : (8 h d) \0 */</span>
<span class="linenos"> 17</span><span class="p">};</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="k">static</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="nf">keystr</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">keystr</span><span class="w"> </span><span class="o">*</span><span class="n">gs</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">dds_builtintopic_topic_key_t</span><span class="w"> </span><span class="o">*</span><span class="n">g</span><span class="p">)</span>
<span class="linenos"> 20</span><span class="p">{</span>
<span class="linenos"> 21</span><span class="w">  </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">snprintf</span><span class="w"> </span><span class="p">(</span><span class="n">gs</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="n">gs</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">),</span>
<span class="linenos"> 22</span><span class="w">                   </span><span class="s">&quot;%02x%02x%02x%02x:%02x%02x%02x%02x:%02x%02x%02x%02x:%02x%02x%02x%02x&quot;</span><span class="p">,</span>
<span class="linenos"> 23</span><span class="w">                   </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="w"> </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="w"> </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
<span class="linenos"> 24</span><span class="w">                   </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span><span class="w"> </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span><span class="w"> </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span><span class="w"> </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span><span class="w"> </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span><span class="w"> </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span><span class="w"> </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span><span class="w"> </span><span class="n">g</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">[</span><span class="mi">15</span><span class="p">]);</span>
<span class="linenos"> 25</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">gs</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">;</span>
<span class="linenos"> 26</span><span class="p">}</span>
<span class="linenos"> 27</span>
<span class="linenos"> 28</span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="nf">instance_state_str</span><span class="w"> </span><span class="p">(</span><span class="n">dds_instance_state_t</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="linenos"> 29</span><span class="p">{</span>
<span class="linenos"> 30</span><span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="linenos"> 31</span><span class="w">  </span><span class="p">{</span>
<span class="linenos"> 32</span><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">DDS_ALIVE_INSTANCE_STATE</span><span class="p">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;alive&quot;</span><span class="p">;</span>
<span class="linenos"> 33</span><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">DDS_NOT_ALIVE_NO_WRITERS_INSTANCE_STATE</span><span class="p">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;nowriters&quot;</span><span class="p">;</span>
<span class="linenos"> 34</span><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">DDS_NOT_ALIVE_DISPOSED_INSTANCE_STATE</span><span class="p">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;disposed&quot;</span><span class="p">;</span>
<span class="linenos"> 35</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 36</span><span class="w">  </span><span class="n">assert</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="linenos"> 37</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="linenos"> 38</span><span class="p">}</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">process_topic</span><span class="w"> </span><span class="p">(</span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">readcond</span><span class="p">)</span>
<span class="linenos"> 41</span><span class="p">{</span>
<span class="linenos"> 42</span><span class="cp">#define MAXCOUNT 10</span>
<span class="linenos"> 43</span><span class="w">  </span><span class="cm">/* dds_take allocates memory for the data if samples[0] is a null pointer, and reuses</span>
<span class="linenos"> 44</span><span class="cm">     it otherwise, so it must be initialized properly.  The &quot;10&quot; is arbitrary. */</span>
<span class="linenos"> 45</span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">samples</span><span class="p">[</span><span class="n">MAXCOUNT</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">};</span>
<span class="linenos"> 46</span><span class="w">  </span><span class="n">dds_sample_info_t</span><span class="w"> </span><span class="n">infos</span><span class="p">[</span><span class="n">MAXCOUNT</span><span class="p">];</span>
<span class="linenos"> 47</span><span class="w">  </span><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos"> 48</span><span class="w">  </span><span class="cm">/* Using the condition that was attached to the waitset means one never accidentally</span>
<span class="linenos"> 49</span><span class="cm">     filters out some samples that the waitset triggers on.  Because waitsets are</span>
<span class="linenos"> 50</span><span class="cm">     level-triggered, that would result in a spinning thread. */</span>
<span class="linenos"> 51</span><span class="w">  </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_take</span><span class="w"> </span><span class="p">(</span><span class="n">readcond</span><span class="p">,</span><span class="w"> </span><span class="n">samples</span><span class="p">,</span><span class="w"> </span><span class="n">infos</span><span class="p">,</span><span class="w"> </span><span class="n">MAXCOUNT</span><span class="p">,</span><span class="w"> </span><span class="n">MAXCOUNT</span><span class="p">);</span>
<span class="linenos"> 52</span><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">topics_seen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="linenos"> 53</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int32_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="linenos"> 54</span><span class="w">  </span><span class="p">{</span>
<span class="linenos"> 55</span><span class="w">    </span><span class="n">dds_builtintopic_topic_t</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="linenos"> 56</span><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">keystr</span><span class="w"> </span><span class="n">gs</span><span class="p">;</span>
<span class="linenos"> 57</span><span class="w">    </span><span class="n">printf</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;%s: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">instance_state_str</span><span class="w"> </span><span class="p">(</span><span class="n">infos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">instance_state</span><span class="p">),</span><span class="w"> </span><span class="n">keystr</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">gs</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sample</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">));</span>
<span class="linenos"> 58</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">infos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">valid_data</span><span class="p">)</span>
<span class="linenos"> 59</span><span class="w">    </span><span class="p">{</span>
<span class="linenos"> 60</span><span class="w">      </span><span class="n">printf</span><span class="w"> </span><span class="p">(</span><span class="s">&quot; %s %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sample</span><span class="o">-&gt;</span><span class="n">topic_name</span><span class="p">,</span><span class="w"> </span><span class="n">sample</span><span class="o">-&gt;</span><span class="n">type_name</span><span class="p">);</span>
<span class="linenos"> 61</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strncmp</span><span class="w"> </span><span class="p">(</span><span class="n">sample</span><span class="o">-&gt;</span><span class="n">topic_name</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DCPS&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 62</span><span class="w">      </span><span class="p">{</span>
<span class="linenos"> 63</span><span class="w">        </span><span class="cm">/* Topic names starting with DCPS are guaranteed to be built-in topics, so we</span>
<span class="linenos"> 64</span><span class="cm">           have discovered an application topic if the name doesn&#39;t start with DCPS */</span>
<span class="linenos"> 65</span><span class="w">        </span><span class="n">topics_seen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="linenos"> 66</span><span class="w">      </span><span class="p">}</span>
<span class="linenos"> 67</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 68</span><span class="w">    </span><span class="n">printf</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos"> 69</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 70</span><span class="w">  </span><span class="cm">/* Release memory allocated by dds_take */</span>
<span class="linenos"> 71</span><span class="w">  </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">dds_return_loan</span><span class="w"> </span><span class="p">(</span><span class="n">readcond</span><span class="p">,</span><span class="w"> </span><span class="n">samples</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
<span class="linenos"> 72</span><span class="cp">#undef MAXCOUNT</span>
<span class="linenos"> 73</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">topics_seen</span><span class="p">;</span>
<span class="linenos"> 74</span><span class="p">}</span>
<span class="linenos"> 75</span>
<span class="linenos"> 76</span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">process_pubsub</span><span class="w"> </span><span class="p">(</span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">ep_readconds</span><span class="p">[])</span>
<span class="linenos"> 77</span><span class="p">{</span>
<span class="linenos"> 78</span><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">endpoints_exist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="linenos"> 79</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="n">ep_topics</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="n">ep_topics</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">endpoints_exist</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span>
<span class="linenos"> 80</span><span class="w">  </span><span class="p">{</span>
<span class="linenos"> 81</span><span class="w">    </span><span class="cm">/* Reuse samples/infos arrays when checking for readers/writers, using a single sample</span>
<span class="linenos"> 82</span><span class="cm">       is just as arbitrary as using MAXCOUNT samples in process_topic */</span>
<span class="linenos"> 83</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sampleptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos"> 84</span><span class="w">    </span><span class="n">dds_sample_info_t</span><span class="w"> </span><span class="n">info</span><span class="p">;</span>
<span class="linenos"> 85</span><span class="w">    </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_take</span><span class="w"> </span><span class="p">(</span><span class="n">ep_readconds</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sampleptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="linenos"> 86</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 87</span><span class="w">    </span><span class="p">{</span>
<span class="linenos"> 88</span><span class="w">      </span><span class="n">dds_builtintopic_endpoint_t</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sampleptr</span><span class="p">;</span>
<span class="linenos"> 89</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">valid_data</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">strncmp</span><span class="w"> </span><span class="p">(</span><span class="n">sample</span><span class="o">-&gt;</span><span class="n">topic_name</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DCPS&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 90</span><span class="w">        </span><span class="n">endpoints_exist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="linenos"> 91</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 92</span><span class="w">    </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">dds_return_loan</span><span class="w"> </span><span class="p">(</span><span class="n">ep_readconds</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sampleptr</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
<span class="linenos"> 93</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 94</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">endpoints_exist</span><span class="p">;</span>
<span class="linenos"> 95</span><span class="p">}</span>
<span class="linenos"> 96</span>
<span class="linenos"> 97</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="linenos"> 98</span><span class="p">{</span>
<span class="linenos"> 99</span><span class="w">  </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">argc</span><span class="p">;</span>
<span class="linenos">100</span><span class="w">  </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">argv</span><span class="p">;</span>
<span class="linenos">101</span>
<span class="linenos">102</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">participant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_participant</span><span class="w"> </span><span class="p">(</span><span class="n">DDS_DOMAIN_DEFAULT</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="linenos">103</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">104</span><span class="w">  </span><span class="p">{</span>
<span class="linenos">105</span><span class="w">    </span><span class="n">fprintf</span><span class="w"> </span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dds_create_participant: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dds_strretcode</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">));</span>
<span class="linenos">106</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">107</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">108</span>
<span class="linenos">109</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">waitset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_waitset</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">);</span>
<span class="linenos">110</span>
<span class="linenos">111</span><span class="w">  </span><span class="cm">/* Create a reader for the DCPSTopic built-in topic.  The built-in topics are identified</span>
<span class="linenos">112</span><span class="cm">     using compile-time constants rather than ordinary, dynamically allocated handles.  In</span>
<span class="linenos">113</span><span class="cm">     Cyclone&#39;s C API, any QoS settings left unspecified in the reader and writer QoS are</span>
<span class="linenos">114</span><span class="cm">     inherited from the topic QoS, and so specifying no QoS object results in a</span>
<span class="linenos">115</span><span class="cm">     transient-local, reliable reader. */</span>
<span class="linenos">116</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_reader</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_BUILTIN_TOPIC_DCPSTOPIC</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="linenos">117</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">118</span><span class="w">  </span><span class="p">{</span>
<span class="linenos">119</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DDS_RETCODE_UNSUPPORTED</span><span class="p">)</span>
<span class="linenos">120</span><span class="w">      </span><span class="n">fprintf</span><span class="w"> </span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Topic discovery is not included in the build, rebuild with ENABLE_TOPIC_DISCOVERY=ON</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">121</span><span class="w">    </span><span class="k">else</span>
<span class="linenos">122</span><span class="w">      </span><span class="n">fprintf</span><span class="w"> </span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dds_create_reader(DCPSTopic): %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dds_strretcode</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">));</span>
<span class="linenos">123</span><span class="w">    </span><span class="n">dds_delete</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">);</span>
<span class="linenos">124</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">125</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">126</span>
<span class="linenos">127</span><span class="w">  </span><span class="cm">/* Create a read condition and attach it to the waitset.  Using a read condition for</span>
<span class="linenos">128</span><span class="cm">     ANY_STATE is almost, but not quite, equivalent to setting the status mask to</span>
<span class="linenos">129</span><span class="cm">     DATA_AVAILABLE and attaching the reader directly: the read condition remains in a</span>
<span class="linenos">130</span><span class="cm">     triggered state until the reader history cache no longer contains any matching</span>
<span class="linenos">131</span><span class="cm">     samples, but the DATA_AVAILABLE state is reset on a call to read/take and only raised</span>
<span class="linenos">132</span><span class="cm">     again on the receipt of the next sample.  Reading only a limited number of samples</span>
<span class="linenos">133</span><span class="cm">     every time DATA_AVAILABLE triggers therefore risks never reading some samples. */</span>
<span class="linenos">134</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">readcond</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_readcondition</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_ANY_STATE</span><span class="p">);</span>
<span class="linenos">135</span><span class="w">  </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">dds_waitset_attach</span><span class="w"> </span><span class="p">(</span><span class="n">waitset</span><span class="p">,</span><span class="w"> </span><span class="n">readcond</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="linenos">136</span>
<span class="linenos">137</span><span class="w">  </span><span class="cm">/* Also create readers for the DCPSPublication and DCPSSubscription topics so we can</span>
<span class="linenos">138</span><span class="cm">     warn if topic discovery is most likely disabled in the configuration. */</span>
<span class="linenos">139</span><span class="w">  </span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">ep_readers</span><span class="p">[</span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="n">ep_topics</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="n">ep_topics</span><span class="p">[</span><span class="mi">0</span><span class="p">])];</span>
<span class="linenos">140</span><span class="w">  </span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">ep_readconds</span><span class="p">[</span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="n">ep_topics</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="n">ep_topics</span><span class="p">[</span><span class="mi">0</span><span class="p">])];</span>
<span class="linenos">141</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="n">ep_topics</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="n">ep_topics</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span>
<span class="linenos">142</span><span class="w">  </span><span class="p">{</span>
<span class="linenos">143</span><span class="w">    </span><span class="n">ep_readers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_reader</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">,</span><span class="w"> </span><span class="n">ep_topics</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="linenos">144</span><span class="w">    </span><span class="n">ep_readconds</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_readcondition</span><span class="w"> </span><span class="p">(</span><span class="n">ep_readers</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="w"> </span><span class="n">DDS_ANY_STATE</span><span class="p">);</span>
<span class="linenos">145</span><span class="w">    </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">dds_waitset_attach</span><span class="w"> </span><span class="p">(</span><span class="n">waitset</span><span class="p">,</span><span class="w"> </span><span class="n">ep_readconds</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="linenos">146</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">147</span>
<span class="linenos">148</span><span class="w">  </span><span class="cm">/* Keep track of whether (non-built-in) topics were discovered and of whether</span>
<span class="linenos">149</span><span class="cm">     (non-built-in) endpoints were for generating a warning that the configuration likely</span>
<span class="linenos">150</span><span class="cm">     has topic discovery disabled if only endpoints got discovered. */</span>
<span class="linenos">151</span><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">topics_seen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="linenos">152</span><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">endpoints_exist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="linenos">153</span>
<span class="linenos">154</span><span class="w">  </span><span class="cm">/* Monitor topic creation/deletion for 10s.  There is no risk of spurious wakeups in a</span>
<span class="linenos">155</span><span class="cm">     simple case like this and so a timeout from wait_until really means that tstop has</span>
<span class="linenos">156</span><span class="cm">     passed. */</span>
<span class="linenos">157</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">dds_time_t</span><span class="w"> </span><span class="n">tstop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_time</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">DDS_SECS</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="linenos">158</span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">dds_waitset_wait_until</span><span class="w"> </span><span class="p">(</span><span class="n">waitset</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">tstop</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">159</span><span class="w">  </span><span class="p">{</span>
<span class="linenos">160</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">process_topic</span><span class="w"> </span><span class="p">(</span><span class="n">readcond</span><span class="p">))</span>
<span class="linenos">161</span><span class="w">      </span><span class="n">topics_seen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="linenos">162</span>
<span class="linenos">163</span><span class="w">    </span><span class="cm">/* No point in looking for other readers/writers once we know some exist */</span>
<span class="linenos">164</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">endpoints_exist</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">process_pubsub</span><span class="w"> </span><span class="p">(</span><span class="n">ep_readconds</span><span class="p">))</span>
<span class="linenos">165</span><span class="w">    </span><span class="p">{</span>
<span class="linenos">166</span><span class="w">      </span><span class="n">endpoints_exist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="linenos">167</span><span class="w">      </span><span class="cm">/* The readers used for monitoring the existence of readers/writers are no longer</span>
<span class="linenos">168</span><span class="cm">         useful once some eps have been seen.  Deleting them will also detach the</span>
<span class="linenos">169</span><span class="cm">         read conditions from the waitset and delete them. */</span>
<span class="linenos">170</span><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="n">ep_readers</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="p">(</span><span class="n">ep_readers</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span>
<span class="linenos">171</span><span class="w">        </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">dds_delete</span><span class="w"> </span><span class="p">(</span><span class="n">ep_readers</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
<span class="linenos">172</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">173</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">174</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">topics_seen</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">endpoints_exist</span><span class="p">)</span>
<span class="linenos">175</span><span class="w">  </span><span class="p">{</span>
<span class="linenos">176</span><span class="w">    </span><span class="n">fprintf</span><span class="w"> </span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;No topics discovered but remote readers/writers exist. Is topic discovery enabled in the configuration?</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">177</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">178</span>
<span class="linenos">179</span><span class="w">  </span><span class="n">dds_delete</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">);</span>
<span class="linenos">180</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">181</span><span class="p">}</span>
</pre></div>
</div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
    
        <div id="show_right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon"><</span><span>Page contents<span></a></p>
        </div>

        <div id="right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon">></span><span>Page contents:<span></a></p>
            <div class="page_toc">
                <ul>
<li><a class="reference internal" href="#">listtopics</a><ul>
<li><a class="reference internal" href="#running-the-example">Running the example</a></li>
<li><a class="reference internal" href="#source-code">Source code</a></li>
</ul>
</li>
</ul>

            </div>
        </div>
    

      <div class="clearer"></div>
    </div>
    <div class="button_nav_wrapper">
        <div class="button_nav">
            <div class="left">
                
                <a href="throughput.html">
                    <span class="icon"><</span><span>Throughput</span></a>
                
            </div>

            <div class="right">
                
                    <a href="dynsub.html"><span>dynsub</span><span class="icon">></span></a>
                
            </div>
        </div>
    </div>


    <div class="footer" role="contentinfo">
        &#169; Copyright 2025, Eclipse Cyclone DDS committers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.0.0.
    </div>

<p id="theme_credit">Styled using the <a href="https://github.com/piccolo-orm/piccolo_theme">Piccolo Theme</a></p>
  </body>
</html>