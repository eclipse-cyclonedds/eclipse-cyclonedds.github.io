
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>C Tutorial &#8212; Eclipse Cyclone DDS, 0.11.0</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic_mod.css?v=0.7.0-1" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/helpers.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/js/helpers.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <script src="../../_static/js/petite-vue.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="C++ Tutorial" href="../cpp_tutorial/index.html" />
    <link rel="prev" title="Installation" href="../installation/index.html" /> 
  </head><body>

<div id="top_nav">
    

    <nav>
        <p id="toggle_sidebar">
            <a href="#" title="Toggle sidebar">|||</a>
        </p>
        <h1><a href="../../index.html" title="Go to homepage">Eclipse Cyclone DDS, 0.11.0</a></h1>

        <a id="mode_toggle" href="#" @click.prevent="handleClick" :title="mode">
    <template v-if="mode == 'light'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_light"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M67.48,18.073c1.913,-1.912 1.913,-5.018 0,-6.931c-1.912,-1.912 -5.018,-1.912 -6.931,0l-6.798,6.799c-1.912,1.912 -1.912,5.018 0,6.931c1.913,1.912 5.018,1.912 6.931,-0l6.798,-6.799Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.728,61.108c1.912,-1.913 1.912,-5.018 -0,-6.931c-1.913,-1.913 -5.019,-1.913 -6.931,-0l-6.799,6.798c-1.912,1.913 -1.912,5.019 0,6.931c1.913,1.913 5.019,1.913 6.931,0l6.799,-6.798Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.682,54.177c-1.913,-1.913 -5.018,-1.913 -6.931,-0c-1.912,1.913 -1.912,5.018 0,6.931l6.798,6.798c1.913,1.913 5.019,1.913 6.931,0c1.913,-1.912 1.913,-5.018 0,-6.931l-6.798,-6.798Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M4.901,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,-0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M18.929,11.142c-1.912,-1.912 -5.018,-1.912 -6.931,0c-1.912,1.913 -1.912,5.019 0,6.931l6.799,6.799c1.912,1.912 5.018,1.912 6.931,-0c1.912,-1.913 1.912,-5.019 -0,-6.931l-6.799,-6.799Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.108,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c-0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c-0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'dark'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_dark"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.901,2.196 -4.901,4.901c0,2.705 2.197,4.901 4.901,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.662,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.989,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.732,61.103c1.91,-1.91 1.91,-5.011 0,-6.921l-0.009,-0.01c-1.91,-1.91 -5.012,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.909,1.91 5.011,1.91 6.92,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.672,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.52,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l-0,-0.01c-0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.901,2.196 -4.901,4.901c0,2.704 2.197,4.9 4.901,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.73,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 -0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.098,34.623c-2.699,0 -4.891,2.192 -4.891,4.892l-0,0.019c-0,2.699 2.192,4.891 4.891,4.891c2.7,0 4.892,-2.192 4.892,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.892,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'darkest'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_darkest"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><path d="M39.315,23.791c8.684,-0 15.734,7.05 15.734,15.733c0,8.684 -7.05,15.734 -15.734,15.734c-8.683,0 -15.733,-7.05 -15.733,-15.734c-0,-8.683 7.05,-15.733 15.733,-15.733Zm0,4.737c6.069,0 10.997,4.927 10.997,10.996c-0,6.069 -4.928,10.996 -10.997,10.996c-6.068,0 -10.996,-4.927 -10.996,-10.996c0,-6.069 4.928,-10.996 10.996,-10.996Z" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.216,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.9,2.196 -4.9,4.901c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.666,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.99,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.737,61.103c1.909,-1.91 1.909,-5.011 -0,-6.921l-0.01,-0.01c-1.91,-1.91 -5.011,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.91,1.91 5.011,1.91 6.921,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.676,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.524,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l0,-0.01c0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.216,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901c-0,2.704 2.196,4.9 4.9,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.734,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.103,34.623c-2.7,0 -4.892,2.192 -4.892,4.892l-0,0.019c-0,2.699 2.192,4.891 4.892,4.891c2.699,0 4.891,-2.192 4.891,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.891,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>
</a>

<script>
(function() {
    const LOCAL_STORAGE_KEY = 'piccoloThemeMode'

    var initialMode = localStorage.getItem(LOCAL_STORAGE_KEY)

    if (initialMode) {
        // Make sure the value in local storage is valid
        if (['light', 'dark', 'darkest'].indexOf(initialMode) == -1) {
            initialMode = 'light'
            localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
        }
    } else {
        // Check if the client prefers dark mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            initialMode = 'dark'
        } else {
            initialMode = 'light'
        }
        localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
    }

    document.documentElement.dataset.mode = initialMode

    PetiteVue.createApp({
        'mode': initialMode,
        handleClick() {
            let currentMode = this.mode

            if (currentMode == 'light') {
                this.mode = 'dark'
            } else if (currentMode == 'dark') {
                this.mode = 'darkest'
            } else if (currentMode == 'darkest') {
                this.mode = 'light'
            }

            document.documentElement.dataset.mode = this.mode
            localStorage.setItem(LOCAL_STORAGE_KEY, this.mode)

            console.log(this.mode)
        }
    }).mount('#mode_toggle')
})()
</script>
            <p class="mobile_search_link">
                <a href="../../search.html" title="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 65 64" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2">
                        <path d="M14.873 40.009c-2.315-3.943-3.642-8.532-3.642-13.429C11.231 11.91 23.141 0 37.811 0s26.58 11.91 26.58 26.58-11.91 26.58-26.58 26.58a26.44 26.44 0 0 1-14.277-4.161L9.739 62.794a3.12 3.12 0 0 1-4.413 0L.913 58.382c-1.217-1.218-1.217-3.196 0-4.413l13.96-13.96zM37.811 8.054c10.225 0 18.526 8.301 18.526 18.526s-8.301 18.526-18.526 18.526-18.526-8.301-18.526-18.526S27.586 8.054 37.811 8.054z" fill="#fff" />
                    </svg>
                </a>
            </p>
        

        <div class="searchbox_wrapper">
            
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
    </nav>
</div>

    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">C Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cpp_tutorial/index.html">C++ Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py_tutorial/index.html">Python Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../benchmarking.html">Benchmarking Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html">Contributing to Eclipse Cyclone DDS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../config/index.html">Configuration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">DDS Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../shared_memory.html">Shared Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ddsc.html">C API Reference</a></li>
</ul>

        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="c-tutorial">
<h1>C Tutorial<a class="headerlink" href="#c-tutorial" title="Permalink to this headline">¶</a></h1>
<section id="building-your-own-dds-hello-world">
<h2>Building your own DDS <strong>Hello World!</strong><a class="headerlink" href="#building-your-own-dds-hello-world" title="Permalink to this headline">¶</a></h2>
<p>To test the complete workflow of building a DDS-based application, you
can use the simple <strong>Hello World!</strong> but now build it yourself instead.
Although this application does not reveal all the power of building a
data-centric application, it has the merit of introducing you to the basic
steps to create a DDS application.</p>
<p>First we will focus on building this example without analyzing the source code.
Next, we will analyze the source code to see what makes it tick.</p>
<p>The procedure used to build the <strong>Hello World!</strong> example can also be used
for building your own applications.</p>
<p>Start by copying <code class="docutils literal notranslate"><span class="pre">examples/helloworld</span></code> to a new workspace and open a terminal
in that directory. Six files are available under the <strong>Hello* *World!</strong> root directory to
support building the example. For this chapter, we mainly describe:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HelloWorldData.idl</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">publisher.c</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">subscriber.c</span></code></p></li>
</ul>
<section id="building-the-hello-world-application-with-cmake">
<h3>Building the <strong>Hello World!</strong> application with CMake<a class="headerlink" href="#building-the-hello-world-application-with-cmake" title="Permalink to this headline">¶</a></h3>
<p>In the previous sections, building the <strong>Hello World!</strong> example is done
by default during the Cyclone DDS build process. However, the <strong>Hello World!</strong> example
can also be built on its own. We do this, again, using the CMake build tool.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CMake</p>
<p><a class="reference external" href="http://cmake.org/">CMake</a> is an open-source, cross-platform family
of tools designed to build, test, and package software. It controls
the software compilation process using simple platform and
compiler-independent configuration files. It also generates native
makefiles, projects, and workspaces of your development environment.
CMake’s main strength is built portability. The same CMake input files
build with GNU make, Visual Studio 6,7,8 IDEs, Borland make, nmake, and
XCode, etc…</p>
<p>Another advantage of CMake is building out-of-source. It simply works
out of the box. This facilitates:</p>
<blockquote>
<div><ul class="simple">
<li><p>Easy cleanup (no cluttering the source tree). Remove the build
directory to start from scratch.</p></li>
<li><p>Multiple build targets. It’s possible to have up-to-date Debug and
Release targets without having to recompile the entire tree. It is easy for
systems that do the cross-platform compilation to have
up-to-date builds for the host and target platform.</p></li>
</ul>
</div></blockquote>
</div>
<p>To use CMake, you need to provide a <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>. We will use the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>
that comes with the <strong>Hello World!</strong> example. The content is shown below:</p>
<p>The content of the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> is:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">#</span>
<span class="linenos"> 2</span><span class="c"># Copyright(c) 2019 to 2022 ZettaScale Technology and others</span>
<span class="linenos"> 3</span><span class="c">#</span>
<span class="linenos"> 4</span><span class="c"># This program and the accompanying materials are made available under the</span>
<span class="linenos"> 5</span><span class="c"># terms of the Eclipse Public License v. 2.0 which is available at</span>
<span class="linenos"> 6</span><span class="c"># http://www.eclipse.org/legal/epl-2.0, or the Eclipse Distribution License</span>
<span class="linenos"> 7</span><span class="c"># v. 1.0 which is available at</span>
<span class="linenos"> 8</span><span class="c"># http://www.eclipse.org/org/documents/edl-v10.php.</span>
<span class="linenos"> 9</span><span class="c">#</span>
<span class="linenos">10</span><span class="c"># SPDX-License-Identifier: EPL-2.0 OR BSD-3-Clause</span>
<span class="linenos">11</span><span class="c">#</span>
<span class="linenos">12</span><span class="nb">project</span><span class="p">(</span><span class="s">helloword</span><span class="w"> </span><span class="s">LANGUAGES</span><span class="w"> </span><span class="s">C</span><span class="p">)</span>
<span class="linenos">13</span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.16</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="nb">if</span><span class="p">(</span><span class="s">NOT</span><span class="w"> </span><span class="s">TARGET</span><span class="w"> </span><span class="s">CycloneDDS::ddsc</span><span class="p">)</span>
<span class="linenos">16</span><span class="w">  </span><span class="c"># Find the CycloneDDS package.</span>
<span class="linenos">17</span><span class="w">  </span><span class="nb">find_package</span><span class="p">(</span><span class="s">CycloneDDS</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="linenos">18</span><span class="nb">endif</span><span class="p">()</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="c"># This is a convenience function, provided by the CycloneDDS package,</span>
<span class="linenos">21</span><span class="c"># that will supply a library target related the the given idl file.</span>
<span class="linenos">22</span><span class="c"># In short, it takes the idl file, generates the source files with</span>
<span class="linenos">23</span><span class="c"># the proper data types and compiles them into a library.</span>
<span class="linenos">24</span><span class="nb">idlc_generate</span><span class="p">(</span><span class="s">TARGET</span><span class="w"> </span><span class="s">HelloWorldData_lib</span><span class="w"> </span><span class="s">FILES</span><span class="w"> </span><span class="s2">&quot;HelloWorldData.idl&quot;</span><span class="w"> </span><span class="s">WARNINGS</span><span class="w"> </span><span class="s">no-implicit-extensibility</span><span class="p">)</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="c"># Both executables have only one related source file.</span>
<span class="linenos">27</span><span class="nb">add_executable</span><span class="p">(</span><span class="s">HelloworldPublisher</span><span class="w"> </span><span class="s">publisher.c</span><span class="p">)</span>
<span class="linenos">28</span><span class="nb">add_executable</span><span class="p">(</span><span class="s">HelloworldSubscriber</span><span class="w"> </span><span class="s">subscriber.c</span><span class="p">)</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="c"># Both executables need to be linked to the idl data type library and</span>
<span class="linenos">31</span><span class="c"># the ddsc API library.</span>
<span class="linenos">32</span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">HelloworldPublisher</span><span class="w"> </span><span class="s">HelloWorldData_lib</span><span class="w"> </span><span class="s">CycloneDDS::ddsc</span><span class="p">)</span>
<span class="linenos">33</span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">HelloworldSubscriber</span><span class="w"> </span><span class="s">HelloWorldData_lib</span><span class="w"> </span><span class="s">CycloneDDS::ddsc</span><span class="p">)</span>
</pre></div>
</div>
<p>To build a Cyclone DDS based application, you need to link your business code with:</p>
<blockquote>
<div><ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">ddsc</span></code> library that contains the DDS API the application needs.</p></li>
<li><p>The helper functions and structures that represent your datatypes.
These helpers are generated by the IDL compiler and can
be accessed through the CMake (<code class="docutils literal notranslate"><span class="pre">idlc_generate</span></code>) call that takes the
idl file (e.g <code class="docutils literal notranslate"><span class="pre">HelloWorld.idl</span></code>) as input and packages the datatyped
helpers in a library (e.g. <code class="docutils literal notranslate"><span class="pre">HelloWorldData_lib</span></code>).</p></li>
</ul>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">idlc_generate</span></code> call makes use of how the IDL compiler
generates the helpers’ functions and structures. This process is depicted below.</p>
<img alt="../../_images/dds-application-design.png" class="align-center" src="../../_images/dds-application-design.png" />
<p>The executables of the Cyclone DDS-based application (in this case <code class="docutils literal notranslate"><span class="pre">HelloworldPublisher</span></code>
and <code class="docutils literal notranslate"><span class="pre">HelloworldSubscriber</span></code>) are linked to Cyclone DDS with the CMake <code class="docutils literal notranslate"><span class="pre">target_link_libraries()</span></code>
call. This call combines the <code class="docutils literal notranslate"><span class="pre">ddsc</span></code> lib, the datatype helper lib and the application code.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CMake attempts to find the <code class="docutils literal notranslate"><span class="pre">CycloneDDS</span></code> CMake package in the default system locations.
If you experience problems with not being able to locate <code class="docutils literal notranslate"><span class="pre">CycloneDDS</span></code> it is often enough to include the Cyclone DDS &lt;install-location&gt; as
CMake Prefix Path like so: <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-DCMAKE_PREFIX_PATH=&lt;install-location&gt;</span></code>. If you have further issues, please
consult CMake’s <a class="reference external" href="https://cmake.org/cmake/help/latest/guide/using-dependencies/index.html#guide:Using%20Dependencies%20Guide">Using dependencies guide</a>.</p>
</div>
</section>
<section id="building-the-hello-world-example">
<h3>Building the <strong>Hello World!</strong> Example<a class="headerlink" href="#building-the-hello-world-example" title="Permalink to this headline">¶</a></h3>
<p>With our <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file in hand we can now start the build process.
It’s good practice to build examples or applications out-of-source by creating a <code class="docutils literal notranslate"><span class="pre">build</span></code> directory inside
where you copied the <strong>Hello World!</strong> example. In the terminal that you opened inside the directory with
the <strong>Hello World!</strong> files run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build
<span class="nb">cd</span> build
</pre></div>
</div>
<p>Now you can configure the build environment:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button><button aria-controls="panel-0-bWFjT1M=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-bWFjT1M=" name="bWFjT1M=" role="tab" tabindex="-1">macOS</button><button aria-controls="panel-0-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-0-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-0-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -DCMAKE_PREFIX_PATH<span class="o">=</span>&lt;install-location&gt; ..
</pre></div>
</div>
</div><div aria-labelledby="tab-0-bWFjT1M=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-bWFjT1M=" name="bWFjT1M=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -DCMAKE_PREFIX_PATH<span class="o">=</span>&lt;install-location&gt; ..
</pre></div>
</div>
</div><div aria-labelledby="tab-0-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -G &lt;generator-name&gt; -DCMAKE_PREFIX_PATH<span class="o">=</span>&lt;install-location&gt; ..
</pre></div>
</div>
<p>On Windows you can build with one of several generators. Usually if you omit the <code class="docutils literal notranslate"><span class="pre">-G</span> <span class="pre">&lt;generator-name&gt;</span></code>
it will pick a sensible default, but if it doesn’t work or picks something unexpected you can go to the
<a class="reference external" href="https://cmake.org/cmake/help/latest/manual/cmake-generators.7.html">CMake generators documentation</a>.
For example, “Visual Studio 15 2017 Win64” targets a 64-bit build using Visual Studio 2017.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If manually specifying generators be careful about mixing and matching! If you compiled Cyclone DDS with 32-bit libraries
and you try to compile <strong>Hello World!</strong> as 64-bit or vice-versa it will not work.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Weird things can happen if you mix <code class="docutils literal notranslate"><span class="pre">-DCMAKE_BUILD_TYPE=Release</span></code>, <code class="docutils literal notranslate"><span class="pre">-DCMAKE_BUILD_TYPE=RelWithDebInfo</span></code> and <code class="docutils literal notranslate"><span class="pre">-DCMAKE_BUILD_TYPE=Debug</span></code>,
try to match what you picked for Cyclone DDS in downstream projects.</p>
</div>
</div></div>
<p>CMake uses the CMakeLists.txt in the HelloWorld directory to create “makefiles” that target the native platform.
Our build directory is now prepared to build the actual executables (<code class="docutils literal notranslate"><span class="pre">HelloworldPublisher</span></code> and <code class="docutils literal notranslate"><span class="pre">HelloworldSubscriber</span></code> in this case):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake --build .
</pre></div>
</div>
<p>Your build directory should now contain your executables (on Windows they might be in a <code class="docutils literal notranslate"><span class="pre">Release</span></code> or <code class="docutils literal notranslate"><span class="pre">Debug</span></code> subdirectory). You can
execute them in the same way as described in the <a class="reference external" href="#test-your-installation">Test your installation</a> section.</p>
</section>
</section>
<section id="hello-world-code-anatomy">
<h2><strong>Hello World!</strong> Code anatomy<a class="headerlink" href="#hello-world-code-anatomy" title="Permalink to this headline">¶</a></h2>
<p>The previous chapter described the installation process that built
implicitly or explicitly the C <strong>Hello World!</strong> Example.</p>
<p>This chapter introduces the fundamental concept of DDS. It details the structural code of a
simple system made by an application that publishes keyed messages and
another one that subscribes and reads such data. Each message represents
a data object that is uniquely identified with a unique key and a
payload.</p>
<section id="data-centric-architecture">
<h3>Data-Centric Architecture<a class="headerlink" href="#data-centric-architecture" title="Permalink to this headline">¶</a></h3>
<p>In a service-centric architecture, applications need to
know each other’s interfaces to share data, share events, and share
commands or replies to interact. These interfaces are modeled as sets of
operations and functions that are managed in centralized repositories.
This type of architecture creates unnecessary dependencies that form a
tightly coupled system. The centralized interface repositories are
usually seen as a single point of failure.</p>
<p>In a data-centric architecture, your design focuses on the data each
the application produces and decides to share rather than on the Interfaces’
operations and the internal processing that produced them.</p>
<p>A data-centric architecture creates a decoupled system that focuses on
the data and applications states’ that need to be shared rather than the
applications’ details. In a data-centric system, data and their
associated quality of services are the only contracts that bound the
applications together. With DDS, the system decoupling is
bi-dimensional, in both space and time.</p>
<p>Space-decoupling derives from the fact that applications do not need to
know the identity of the data produced or consumed, nor their logical
or a physical location in the network. Under the hood, DDS
runs a zero-configuration, interoperable discovery protocol that
searches matching data readers and data writes that are interested in
the same data topic.</p>
<p>Time-decoupling derives from the fact that, fundamentally, the nature of
communication is asynchronous. Data producers and consumers,
known as <code class="docutils literal notranslate"><span class="pre">DataWriter``s</span> <span class="pre">and</span> <span class="pre">``DataReader``s,</span> <span class="pre">are</span> <span class="pre">not</span> <span class="pre">forced</span> <span class="pre">to</span>
<span class="pre">be</span> <span class="pre">active</span> <span class="pre">and</span> <span class="pre">connected</span> <span class="pre">simultaneously</span> <span class="pre">to</span> <span class="pre">share</span> <span class="pre">data.</span> <span class="pre">In</span> <span class="pre">this</span>
<span class="pre">scenario,</span> <span class="pre">the</span> <span class="pre">DDS</span> <span class="pre">middleware</span> <span class="pre">can</span> <span class="pre">handle</span> <span class="pre">and</span> <span class="pre">manage</span> <span class="pre">data</span> <span class="pre">on</span> <span class="pre">behalf</span> <span class="pre">of</span>
<span class="pre">late</span> <span class="pre">joining</span> <span class="pre">``DataReader</span></code> applications and deliver it to them when they
join the system.</p>
<p>Time and space decoupling gives applications the freedom to be plugged
or unplugged from the system at any time, from anywhere, in any order.
This keeps the complexity and administration of a data-centric
architecture relatively low when adding more and more <code class="docutils literal notranslate"><span class="pre">DataReader</span></code> and
<code class="docutils literal notranslate"><span class="pre">DataWriter</span></code> applications.</p>
</section>
<section id="keys-steps-to-build-the-hello-world-application">
<span id="key-steps"></span><h3>Keys steps to build the <strong>Hello World!</strong> application<a class="headerlink" href="#keys-steps-to-build-the-hello-world-application" title="Permalink to this headline">¶</a></h3>
<p>The <strong>Hello World!</strong> example has a minimal ‘data layer’ with a data
model made of one data type <code class="docutils literal notranslate"><span class="pre">Msg</span></code> that represents keyed messages (c,f
next subsection).</p>
<p>To exchange data with Eclipse Cyclone DDS, applications’ business logic needs
to:</p>
<ol class="arabic simple">
<li><p>Declare its participation and involvement in a <em>DDS domain</em>. A DDS
domain is an administrative boundary that defines, scopes, and
gathers all the DDS applications, data, and infrastructure that must
interconnect by sharing the same data space. Each DDS
domain has a unique identifier. Applications declare their
participation within a DDS domain by creating a <strong>Domain Participant
entity</strong>.</p></li>
<li><p>Create a <strong>Data topic</strong> with the data type described in a data
model. The data types define the structure of the Topic. The Topic is
therefore, an association between the topic’s name and a datatype.
QoSs can be optionally added to this association. The concept Topic
therefore discriminates and categorizes the data in logical classes
and streams.</p></li>
<li><p>Create the <strong>Data Readers</strong> and <strong>Writers</strong> entities
specific to the topic. Applications may want to change the default
QoSs. In the <code class="docutils literal notranslate"><span class="pre">Hello</span> <span class="pre">world!</span></code> Example, the <code class="docutils literal notranslate"><span class="pre">ReliabilityQoS</span></code> is changed
from its default value (<code class="docutils literal notranslate"><span class="pre">Best-effort</span></code>) to <code class="docutils literal notranslate"><span class="pre">Reliable</span></code>.</p></li>
<li><p>Once the previous DDS computational entities are in place, the
application logic can start writing or reading the data.</p></li>
</ol>
<p>At the application level, readers and writers do not need to be aware of
each other. The reading application, now called Subscriber, polls the
data reader periodically until a publishing application, now called
The publisher writes the required data into the shared topic, namely
<code class="docutils literal notranslate"><span class="pre">HelloWorldData_Msg</span></code>.</p>
<p>The data type is described using the OMG IDL.
Language &lt;<a class="reference external" href="http://www.omg.org/gettingstarted/omg_idl.htm">http://www.omg.org/gettingstarted/omg_idl.htm</a>&gt;`__ located in
<code class="docutils literal notranslate"><span class="pre">HelloWorldData.idl</span></code> file. Such IDL file is seen as the data model of
our example.</p>
<p>This data model is preprocessed and compiled by the IDL Compiler
to generate a C representation of the data as described in Chapter 2.
These generated source and header files are used by the
<code class="docutils literal notranslate"><span class="pre">HelloworldSubscriber.c</span></code> and <code class="docutils literal notranslate"><span class="pre">HelloworldPublishe.c</span></code> programs to
share the <strong>Hello World!</strong> Message instance and sample.</p>
<section id="hello-world-idl">
<h4>Hello World! IDL<a class="headerlink" href="#hello-world-idl" title="Permalink to this headline">¶</a></h4>
<p>The HelloWorld data type is described in a language-independent way and
stored in the HelloWorldData.idl file:</p>
<div class="highlight-omg-idl notranslate"><div class="highlight"><pre><span></span><span class="kn">module</span><span class="w"> </span><span class="nn">HelloWorldData</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Msg</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nd">@key</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">userID</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>The data definition language used for DDS corresponds to a subset of
the OMG Interface Definition Language (IDL). In our simple example, the HelloWorld data
model is made of one module <code class="docutils literal notranslate"><span class="pre">HelloWorldData</span></code>. A module can be seen as
a namespace where data with interrelated semantics are represented
together in the same logical set.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">structMsg</span></code> is the data type that shapes the data used to
build topics. As already mentioned, a topic is an association between a
data type and a string name. The topic name is not defined in the IDL
file, but the application business logic determines it at runtime.</p>
<p>In our simplistic case, the data type Msg contains two fields:
<code class="docutils literal notranslate"><span class="pre">userID</span></code> and <code class="docutils literal notranslate"><span class="pre">message</span></code> payload. The <code class="docutils literal notranslate"><span class="pre">userID</span></code> is used to uniquely identify each message instance. This is done using the
<code class="docutils literal notranslate"><span class="pre">&#64;key</span></code> annotation.</p>
<p>The IDL compiler translates the IDL datatype into a C struct
with a name made of the<code class="docutils literal notranslate"><span class="pre">&lt;ModuleName&gt;_&lt;DataTypeName&gt;</span></code> .</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">HelloWorldData_Msg</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">userID</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">message</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="n">HelloWorldData_Msg</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When translated into a different programming language, the
data has another representation specific to the target
language. For instance, as shown in chapter 7, in C++, the Helloworld
data type is represented by a C++ class. This highlights the advantage of using
a neutral language like IDL to describe the data model. It can be
translated into different languages that can be shared between different
applications written in other programming languages.</p>
</div>
</section>
<section id="generated-files-with-the-idl-compiler">
<h4>Generated files with the IDL compiler<a class="headerlink" href="#generated-files-with-the-idl-compiler" title="Permalink to this headline">¶</a></h4>
<p>The IDL compiler is a C program that processes .idl files.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>idlc HelloWorldData.idl
</pre></div>
</div>
<p>This results in new <code class="docutils literal notranslate"><span class="pre">HelloWorldData.c</span></code> and <code class="docutils literal notranslate"><span class="pre">HelloWorldData.h</span></code> files
that need to be compiled, and their associated object file must be linked
with the <strong>Hello World!</strong> publisher and subscriber application business
logic. When using the provided CMake project, this step is done automatically.</p>
<p>As described earlier, the IDL compiler generates one source and one
header file. The header file (<code class="docutils literal notranslate"><span class="pre">HelloWorldData.h</span></code>) contains the shared messages’ data type. While the source file has no
direct use from the application developer’s perspective.</p>
<p><code class="docutils literal notranslate"><span class="pre">HelloWorldData.h</span></code>* needs to be included in the application code as
it contains the actual message type and contains helper macros to
allocate and free memory space for the <code class="docutils literal notranslate"><span class="pre">HelloWorldData_Msg</span></code> type.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">HelloWorldData_Msg</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">userID</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">message</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="n">HelloWorldData_Msg</span><span class="p">;</span><span class="w"></span>

<span class="n">HelloWorldData_Msg_alloc</span><span class="p">()</span><span class="w"></span>
<span class="n">HelloWorldData_Msg_free</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">o</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>The header file also contains an extra variable that describes the data
type to the DDS middleware. This variable needs to be used by the
application when creating the topic.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">HelloWorldData_Msg_desc</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="the-hello-world-business-logic">
<h3>The Hello World! Business Logic<a class="headerlink" href="#the-hello-world-business-logic" title="Permalink to this headline">¶</a></h3>
<p>As well as the <code class="docutils literal notranslate"><span class="pre">HelloWorldData.h/c</span></code> generated files, the <em>Hello
World!</em> example also contains two application-level source files
(<code class="docutils literal notranslate"><span class="pre">subscriber.c</span></code> and <code class="docutils literal notranslate"><span class="pre">publisher.c</span></code>), containing the business logic.</p>
<section id="hello-world-subscriber-source-code">
<h4><strong>Hello World!</strong> Subscriber Source Code<a class="headerlink" href="#hello-world-subscriber-source-code" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">Subscriber.c</span></code> mainly contains the statements to wait for a <em>Hello
World!</em> message and reads it when it receives it.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Cyclone DDS <code class="docutils literal notranslate"><span class="pre">read</span></code> semantics keep the data sample
in the data reader cache. It is important to remember to use <code class="docutils literal notranslate"><span class="pre">take</span></code> where
appropriate to prevent resource exhaustion.</p>
</div>
<p>The subscriber application implements the steps defined in <a class="reference internal" href="#key-steps"><span class="std std-ref">the Key Steps</span></a>.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ddsc/dds.h&quot;</span><span class="cp"></span>
<span class="linenos"> 2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;HelloWorldData.h&quot;</span><span class="cp"></span>
<span class="linenos"> 3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="linenos"> 4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="linenos"> 5</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="cm">/* An array of one message (aka sample in dds terms) will be used. */</span><span class="w"></span>
<span class="linenos"> 8</span><span class="cp">#define MAX_SAMPLES 1</span>
<span class="linenos"> 9</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">10</span><span class="w">  </span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">participant</span><span class="p">;</span><span class="w"></span>
<span class="linenos">11</span><span class="w">  </span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">topic</span><span class="p">;</span><span class="w"></span>
<span class="linenos">12</span><span class="w">  </span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">reader</span><span class="p">;</span><span class="w"></span>
<span class="linenos">13</span><span class="w">  </span><span class="n">HelloWorldData_Msg</span><span class="w"> </span><span class="o">*</span><span class="n">msg</span><span class="p">;</span><span class="w"></span>
<span class="linenos">14</span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">samples</span><span class="p">[</span><span class="n">MAX_SAMPLES</span><span class="p">];</span><span class="w"></span>
<span class="linenos">15</span><span class="w">  </span><span class="n">dds_sample_info_t</span><span class="w"> </span><span class="n">infos</span><span class="p">[</span><span class="n">MAX_SAMPLES</span><span class="p">];</span><span class="w"></span>
<span class="linenos">16</span><span class="w">  </span><span class="n">dds_return_t</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
<span class="linenos">17</span><span class="w">  </span><span class="n">dds_qos_t</span><span class="w"> </span><span class="o">*</span><span class="n">qos</span><span class="p">;</span><span class="w"></span>
<span class="linenos">18</span><span class="w">  </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">argc</span><span class="p">;</span><span class="w"></span>
<span class="linenos">19</span><span class="w">  </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">argv</span><span class="p">;</span><span class="w"></span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="w">  </span><span class="cm">/* Create a Participant. */</span><span class="w"></span>
<span class="linenos">22</span><span class="w">  </span><span class="n">participant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_participant</span><span class="w"> </span><span class="p">(</span><span class="n">DDS_DOMAIN_DEFAULT</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="linenos">23</span><span class="w">  </span><span class="n">DDS_ERR_CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_CHECK_REPORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">DDS_CHECK_EXIT</span><span class="p">);</span><span class="w"></span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="w">  </span><span class="cm">/* Create a Topic. */</span><span class="w"></span>
<span class="linenos">26</span><span class="w">  </span><span class="n">topic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_topic</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">HelloWorldData_Msg_desc</span><span class="p">,</span><span class="w"></span>
<span class="linenos">27</span><span class="w">  </span><span class="s">&quot;HelloWorldData_Msg&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="linenos">28</span><span class="w">  </span><span class="n">DDS_ERR_CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_CHECK_REPORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">DDS_CHECK_EXIT</span><span class="p">);</span><span class="w"></span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="w">  </span><span class="cm">/* Create a reliable Reader. */</span><span class="w"></span>
<span class="linenos">31</span><span class="w">  </span><span class="n">qos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_qos</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="linenos">32</span><span class="w">  </span><span class="n">dds_qset_reliability</span><span class="w"> </span><span class="p">(</span><span class="n">qos</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_RELIABILITY_RELIABLE</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_SECS</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="p">));</span><span class="w"></span>
<span class="linenos">33</span><span class="w">  </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_reader</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">,</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="n">qos</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="linenos">34</span><span class="w">  </span><span class="n">DDS_ERR_CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_CHECK_REPORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">DDS_CHECK_EXIT</span><span class="p">);</span><span class="w"></span>
<span class="linenos">35</span><span class="w">  </span><span class="n">dds_delete_qos</span><span class="p">(</span><span class="n">qos</span><span class="p">);</span><span class="w"></span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="w">  </span><span class="n">printf</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">=== [Subscriber] Waiting for a sample ...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">38</span>
<span class="linenos">39</span><span class="w">  </span><span class="cm">/* Initialize the sample buffer, by pointing the void pointer within</span>
<span class="linenos">40</span><span class="cm">  * the buffer array to a valid sample memory location. */</span><span class="w"></span>
<span class="linenos">41</span><span class="w">  </span><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HelloWorldData_Msg</span><span class="w"> </span><span class="n">alloc</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="linenos">42</span>
<span class="linenos">43</span><span class="w">  </span><span class="cm">/* Poll until data has been read. */</span><span class="w"></span>
<span class="linenos">44</span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"></span>
<span class="linenos">45</span><span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="linenos">46</span><span class="w">    </span><span class="cm">/* Do the actual read.</span>
<span class="linenos">47</span><span class="cm">    * The return value contains the number of samples read. */</span><span class="w"></span>
<span class="linenos">48</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_read</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">,</span><span class="w"> </span><span class="n">samples</span><span class="p">,</span><span class="w"> </span><span class="n">infos</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_SAMPLES</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_SAMPLES</span><span class="p">);</span><span class="w"></span>
<span class="linenos">49</span><span class="w">    </span><span class="n">DDS_ERR_CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_CHECK_REPORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">DDS_CHECK_EXIT</span><span class="p">);</span><span class="w"></span>
<span class="linenos">50</span>
<span class="linenos">51</span><span class="w">    </span><span class="cm">/* Check if we read some data and it is valid. */</span><span class="w"></span>
<span class="linenos">52</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">ret</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">infos</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">valid_data</span><span class="p">))</span><span class="w"></span>
<span class="linenos">53</span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos">54</span><span class="w">        </span><span class="cm">/* Print Message. */</span><span class="w"></span>
<span class="linenos">55</span><span class="w">        </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">HelloWorldData_Msg</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<span class="linenos">56</span><span class="w">        </span><span class="n">printf</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;=== [Subscriber] Received : &quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">57</span><span class="w">        </span><span class="n">printf</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Message (%d, %s)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">userID</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">message</span><span class="p">);</span><span class="w"></span>
<span class="linenos">58</span><span class="w">        </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="linenos">59</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos">60</span><span class="w">    </span><span class="k">else</span><span class="w"></span>
<span class="linenos">61</span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos">62</span><span class="w">        </span><span class="cm">/* Polling sleep. */</span><span class="w"></span>
<span class="linenos">63</span><span class="w">        </span><span class="n">dds_sleepfor</span><span class="w"> </span><span class="p">(</span><span class="n">DDS_MSECS</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">));</span><span class="w"></span>
<span class="linenos">64</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos">65</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos">66</span><span class="w">  </span><span class="cm">/* Free the data location. */</span><span class="w"></span>
<span class="linenos">67</span><span class="w">  </span><span class="n">HelloWorldData_Msg_free</span><span class="w"> </span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">DDS_FREE_ALL</span><span class="p">);</span><span class="w"></span>
<span class="linenos">68</span><span class="w">  </span><span class="cm">/* Deleting the participant will delete all its children recursively as well. */</span><span class="w"></span>
<span class="linenos">69</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_delete</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">);</span><span class="w"></span>
<span class="linenos">70</span><span class="w">  </span><span class="n">DDS_ERR_CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_CHECK_REPORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">DDS_CHECK_EXIT</span><span class="p">);</span><span class="w"></span>
<span class="linenos">71</span>
<span class="linenos">72</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="linenos">73</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Within the subscriber code, we mainly use the DDS API and the
<code class="docutils literal notranslate"><span class="pre">HelloWorldData_Msg</span></code> type. The following header files must be included:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">dds.h</span></code> file to give access to the DDS APIs</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">HelloWorldData.h</span></code> is specific to the data type defined in the IDL</p></li>
</ul>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ddsc/dds.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;HelloWorldData.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<p>With Cyclone DDS, at least three DDS entities are needed to build a
minimalistic application, the domain participant, the topic, and the
reader. Cyclone DDS implicitly creates a DDS Subscriber. If
required, this behavior can be overridden.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">participant</span><span class="p">;</span><span class="w"></span>
<span class="n">dds_entity_t</span><span class="w"> </span><span class="n">topic</span><span class="p">;</span><span class="w"></span>
<span class="n">dds_entity_t</span><span class="w"> </span><span class="n">reader</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>To handle the data, some buffers are declared and created:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">HelloWorldData_Msg</span><span class="w"> </span><span class="o">*</span><span class="n">msg</span><span class="p">;</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">samples</span><span class="p">[</span><span class="n">MAX_SAMPLES</span><span class="p">];</span><span class="w"></span>
<span class="n">dds_sample_info_t</span><span class="w"> </span><span class="n">info</span><span class="p">[</span><span class="n">MAX_SAMPLES</span><span class="p">];</span><span class="w"></span>
</pre></div>
</div>
<p>As the <code class="docutils literal notranslate"><span class="pre">read()</span></code> operation may return more than one data sample (in the
event that several publishing applications are started simultaneously to
write different message instances), an array of samples is therefore
needed.</p>
<p>In Cyclone DDS data and metadata are propagated together. The
<code class="docutils literal notranslate"><span class="pre">dds_sample_info</span></code> array needs to be declared to handle the metadata.</p>
<p>The DDS participant is always attached to a specific DDS domain. In the
<strong>Hello World!</strong> example, it is part of the <code class="docutils literal notranslate"><span class="pre">Default_Domain</span></code>, the one
specified in the XML deployment file (see <a class="reference internal" href="../installation/index.html#test-your-installation"><span class="std std-ref">test your installation</span></a> for more details).</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">participant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_participant</span><span class="w"> </span><span class="p">(</span><span class="n">DDS_DOMAIN_DEFAULT</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The next step is to create the topic with a given name. Topics with the
same data type description and with different names are considered
other topics. This means that readers or writers created for a given
topic do not interfere with readers or writers created with another
topic even if they have the same data type. Topics with the same name but
incompatible datatype are considered an error and should be avoided.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">topic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_topic</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">HelloWorldData_Msg_desc</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;HelloWorldData_Msg&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Once the topic is created, we can create a data reader and attach to it.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">dds_qos_t</span><span class="w"> </span><span class="o">*</span><span class="n">qos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_qos</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="n">dds_qset_reliability</span><span class="w"> </span><span class="p">(</span><span class="n">qos</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_RELIABILITY_RELIABLE</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_SECS</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="p">));</span><span class="w"></span>
<span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_reader</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">,</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="n">qos</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="n">dds_delete_qos</span><span class="p">(</span><span class="n">qos</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The read operation expects an array of pointers to a valid memory
location. This means the samples array needs initialization by pointing
the void pointer within the buffer array to a valid sample memory
location.</p>
<p>In our example, we have an array of one element;
(<code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">MAX_SAMPLES</span> <span class="pre">1</span></code>.) we only need to allocate memory for one
<code class="docutils literal notranslate"><span class="pre">HelloWorldData_Msg</span></code>.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HelloWorldData_Msg_alloc</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
<p>At this stage, we can attempt to read data by going into a polling loop
that regularly scrutinizes and examines the arrival of a message.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_read</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">,</span><span class="w"> </span><span class="n">samples</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_SAMPLES</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_SAMPLES</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">dds_read</span></code> operation returns the number of samples equal to the
parameter <code class="docutils literal notranslate"><span class="pre">MAX_SAMPLE</span></code>. If data has arrived in the reader’s cache,
that number will exceed 0.</p>
<p>The Sample_info (<code class="docutils literal notranslate"><span class="pre">info</span></code>) structure tells us whether the data we read
is <em>Valid</em> or <em>Invalid</em>. Valid data means that it contains the
payload provided by the publishing application. Invalid data means we
are reading the DDS state of the data Instance. The state of a
data instance can be, for instance, <em>DISPOSED</em> by the writer, or it is
<em>NOT_ALIVE</em> anymore, which could happen if the publisher application
terminates while the subscriber is still active. In this case, the
sample is not considered Valid, and its sample <code class="docutils literal notranslate"><span class="pre">info[].Valid_data</span></code>
the field is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">ret</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">valid_data</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
<p>If data is read, then we can cast the void pointer to the actual message
data type and display the contents.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">HelloWorldData_Msg</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<span class="n">printf</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;=== [Subscriber] Received : &quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">printf</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Message (%d, %s)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">userID</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">message</span><span class="p">);</span><span class="w"></span>
<span class="k">break</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>When data is received and the polling loop is stopped, we release the
allocated memory and delete the domain participant.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">HelloWorldData_Msg_free</span><span class="w"> </span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">DDS_FREE_ALL</span><span class="p">);</span><span class="w"></span>
<span class="n">dds_delete</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>All the entities that are created under the participant, such as the
data reader and topic, are recursively deleted.</p>
</section>
<section id="hello-world-publisher-source-code">
<h4><strong>Hello World!</strong> Publisher Source Code<a class="headerlink" href="#hello-world-publisher-source-code" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">Publisher.c</span></code> contains the source that writes a <strong>Hello World!</strong>
Message.</p>
<p>From the DDS perspective, the publisher application code is almost
symmetric to the subscriber one, except that you need to create a data
writer instead of a data reader. To ensure data is written only when at
least one matching reader is discovered, a synchronization
statement is added to the main thread. Synchronizing the main thread
until a reader is discovered ensures we can start the publisher or
subscriber program in any order.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ddsc/dds.h&quot;</span><span class="cp"></span>
<span class="linenos"> 2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;HelloWorldData.h&quot;</span><span class="cp"></span>
<span class="linenos"> 3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="linenos"> 4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 7</span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">    </span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">participant</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">    </span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">topic</span><span class="p">;</span><span class="w"></span>
<span class="linenos">10</span><span class="w">    </span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">writer</span><span class="p">;</span><span class="w"></span>
<span class="linenos">11</span><span class="w">    </span><span class="n">dds_return_t</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
<span class="linenos">12</span><span class="w">    </span><span class="n">HelloWorldData_Msg</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span><span class="w"></span>
<span class="linenos">13</span><span class="w">    </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">argc</span><span class="p">;</span><span class="w"></span>
<span class="linenos">14</span><span class="w">    </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">argv</span><span class="p">;</span><span class="w"></span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="w">    </span><span class="cm">/* Create a Participant. */</span><span class="w"></span>
<span class="linenos">17</span><span class="w">    </span><span class="n">participant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_participant</span><span class="w"> </span><span class="p">(</span><span class="n">DDS_DOMAIN_DEFAULT</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="linenos">18</span><span class="w">    </span><span class="n">DDS_ERR_CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_CHECK_REPORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">DDS_CHECK_EXIT</span><span class="p">);</span><span class="w"></span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="w">    </span><span class="cm">/* Create a Topic. */</span><span class="w"></span>
<span class="linenos">21</span><span class="w">    </span><span class="n">topic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_topic</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">HelloWorldData_Msg_desc</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;HelloWorldData_Msg&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="linenos">22</span><span class="w">    </span><span class="n">DDS_ERR_CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_CHECK_REPORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">DDS_CHECK_EXIT</span><span class="p">);</span><span class="w"></span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="w">    </span><span class="cm">/* Create a Writer. */</span><span class="w"></span>
<span class="linenos">25</span><span class="w">    </span><span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_writer</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">,</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;=== [Publisher] Waiting for a reader to be discovered ...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">28</span>
<span class="linenos">29</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_set_status_mask</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_PUBLICATION_MATCHED_STATUS</span><span class="p">);</span><span class="w"></span>
<span class="linenos">30</span><span class="w">    </span><span class="n">DDS_ERR_CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_CHECK_REPORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">DDS_CHECK_EXIT</span><span class="p">);</span><span class="w"></span>
<span class="linenos">31</span>
<span class="linenos">32</span><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"></span>
<span class="linenos">33</span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos">34</span><span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>
<span class="linenos">35</span><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_get_status_changes</span><span class="w"> </span><span class="p">(</span><span class="n">writer</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">status</span><span class="p">);</span><span class="w"></span>
<span class="linenos">36</span><span class="w">        </span><span class="n">DDS_ERR_CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_CHECK_REPORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">DDS_CHECK_EXIT</span><span class="p">);</span><span class="w"></span>
<span class="linenos">37</span>
<span class="linenos">38</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DDS_PUBLICATION_MATCHED_STATUS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">39</span><span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="linenos">40</span><span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="linenos">41</span><span class="w">        </span><span class="cm">/* Polling sleep. */</span><span class="w"></span>
<span class="linenos">42</span><span class="w">        </span><span class="n">dds_sleepfor</span><span class="w"> </span><span class="p">(</span><span class="n">DDS_MSECS</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">));</span><span class="w"></span>
<span class="linenos">43</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos">44</span>
<span class="linenos">45</span><span class="w">    </span><span class="cm">/* Create a message to write. */</span><span class="w"></span>
<span class="linenos">46</span><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">userID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="linenos">47</span><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello World&quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos">48</span>
<span class="linenos">49</span><span class="w">    </span><span class="n">printf</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;=== [Publisher]    Writing : &quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">50</span><span class="w">    </span><span class="n">printf</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Message (%d, %s)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">userID</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">message</span><span class="p">);</span><span class="w"></span>
<span class="linenos">51</span>
<span class="linenos">52</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_write</span><span class="w"> </span><span class="p">(</span><span class="n">writer</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span><span class="w"></span>
<span class="linenos">53</span><span class="w">    </span><span class="n">DDS_ERR_CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_CHECK_REPORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">DDS_CHECK_EXIT</span><span class="p">);</span><span class="w"></span>
<span class="linenos">54</span>
<span class="linenos">55</span><span class="w">    </span><span class="cm">/* Deleting the participant will delete all its children recursively as well. */</span><span class="w"></span>
<span class="linenos">56</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_delete</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">);</span><span class="w"></span>
<span class="linenos">57</span><span class="w">    </span><span class="n">DDS_ERR_CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_CHECK_REPORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">DDS_CHECK_EXIT</span><span class="p">);</span><span class="w"></span>
<span class="linenos">58</span>
<span class="linenos">59</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="linenos">60</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>We are using the DDS API and the <code class="docutils literal notranslate"><span class="pre">HelloWorldData_Msg</span></code> type to send
data, therefore, we need to include the appropriate header files as we
did in the subscriber code.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ddsc/dds.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;HelloWorldData.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<p>Like the reader in <code class="docutils literal notranslate"><span class="pre">subscriber.c</span></code>, we need a participant and a
topic to create a writer. We must also use the same topic name specified in <code class="docutils literal notranslate"><span class="pre">subscriber.c</span></code>.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">participant</span><span class="p">;</span><span class="w"></span>
<span class="n">dds_entity_t</span><span class="w"> </span><span class="n">topic</span><span class="p">;</span><span class="w"></span>
<span class="n">dds_entity_t</span><span class="w"> </span><span class="n">writer</span><span class="p">;</span><span class="w"></span>

<span class="n">participant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_participant</span><span class="w"> </span><span class="p">(</span><span class="n">DDS_DOMAIN_DEFAULT</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="n">topic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_topic</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">HelloWorldData_Msg_desc</span><span class="p">,</span><span class="w"></span>
<span class="s">&quot;HelloWorldData_Msg&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_writer</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">,</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>When readers and writers are sharing the same data type and topic name,
it connects them without the application’s involvement.
A rendezvous pattern is required to write data only
when a DataReader appears. Such a pattern can be implemented by
either:</p>
<ul class="simple">
<li><p>Waiting for the publication/subscription matched events, where the
Publisher waits and blocks the writing thread until the appropriate
publication-matched event is raised, or</p></li>
<li><p>Regularly polls the publication matching status. This is
the preferred option we implement in this example. The following line of
code instructs Cyclone DDS to listen on the
DDS_PUBLICATION_MATCHED_STATUS:</p></li>
</ul>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">dds_set_status_mask</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_PUBLICATION_MATCHED_STATUS</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>At regular intervals, we get the status change and a matching
publication. In between, the writing thread sleeps for a time period
equal <code class="docutils literal notranslate"><span class="pre">DDS\_MSECS</span></code> (in milliseconds).</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_get_status_changes</span><span class="w"> </span><span class="p">(</span><span class="n">writer</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">status</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">DDS_ERR_CHECK</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">DDS_CHECK_REPORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">DDS_CHECK_EXIT</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DDS_PUBLICATION_MATCHED_STATUS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="cm">/* Polling sleep. */</span><span class="w"></span>
<span class="w">    </span><span class="n">dds_sleepfor</span><span class="w"> </span><span class="p">(</span><span class="n">DDS_MSECS</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">));</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>After this loop, we are sure that a matching reader has been discovered.
Now, we commence the writing of the data instance. First, the data must
be created and initialized.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">HelloWorldData_Msg</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span><span class="w"></span>

<span class="n">msg</span><span class="p">.</span><span class="n">userID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="n">msg</span><span class="p">.</span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello World&quot;</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Then we can send the data instance of the keyed message.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_write</span><span class="w"> </span><span class="p">(</span><span class="n">writer</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>When terminating the program, we free the DDS allocated resources by
deleting the root entity of all the others: the domain participant.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_delete</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>All the underlying entities, such as topic, writer, etc., are deleted.</p>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
    
        <div id="show_right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon"><</span><span>Page contents<span></a></p>
        </div>

        <div id="right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon">></span><span>Page contents:<span></a></p>
            <div class="page_toc">
                <ul>
<li><a class="reference internal" href="#">C Tutorial</a><ul>
<li><a class="reference internal" href="#building-your-own-dds-hello-world">Building your own DDS <strong>Hello World!</strong></a><ul>
<li><a class="reference internal" href="#building-the-hello-world-application-with-cmake">Building the <strong>Hello World!</strong> application with CMake</a></li>
<li><a class="reference internal" href="#building-the-hello-world-example">Building the <strong>Hello World!</strong> Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hello-world-code-anatomy"><strong>Hello World!</strong> Code anatomy</a><ul>
<li><a class="reference internal" href="#data-centric-architecture">Data-Centric Architecture</a></li>
<li><a class="reference internal" href="#keys-steps-to-build-the-hello-world-application">Keys steps to build the <strong>Hello World!</strong> application</a><ul>
<li><a class="reference internal" href="#hello-world-idl">Hello World! IDL</a></li>
<li><a class="reference internal" href="#generated-files-with-the-idl-compiler">Generated files with the IDL compiler</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-hello-world-business-logic">The Hello World! Business Logic</a><ul>
<li><a class="reference internal" href="#hello-world-subscriber-source-code"><strong>Hello World!</strong> Subscriber Source Code</a></li>
<li><a class="reference internal" href="#hello-world-publisher-source-code"><strong>Hello World!</strong> Publisher Source Code</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
        </div>
    

      <div class="clearer"></div>
    </div>
    <div class="button_nav_wrapper">
        <div class="button_nav">
            <div class="left">
                
                <a href="../installation/index.html">
                    <span class="icon"><</span><span>Installation</span></a>
                
            </div>

            <div class="right">
                
                    <a href="../cpp_tutorial/index.html"><span>C++ Tutorial</span><span class="icon">></span></a>
                
            </div>
        </div>
    </div>


    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Eclipse Cyclone DDS committers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0.
    </div>

<p id="theme_credit">Styled using the <a href="https://github.com/piccolo-orm/piccolo_theme">Piccolo Theme</a></p>
  </body>
</html>